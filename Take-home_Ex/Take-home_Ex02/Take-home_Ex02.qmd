---
title: "Take-home Exercise 2 - DataVis Makeover"
author: "Alicia Loh"
date: "April 30, 2024"
date-modified: last-modified
execute: 
  eval: true
  echo: true
  warning: false
  freeze: false
---

# **The Task**

-   Select **one data visualisation** from the [Take-home Exercise 1 submission](https://isss608-ay2023-24apr.netlify.app/take-home_ex/th_ex01#peer-learning) prepared by a peer,

-   Critic the submission in terms of clarity and aesthetics,

-   Prepare a sketch for the alternative design by using the data visualisation design principles and best practices you had learned in Lesson 1 and 2.

-   Remake the original design by using ggplot2, ggplot2 extensions and tidyverse packages.

# **The Source**

The visualisation of this critique is taken from fellow classmate [Seng Jing Yi](https://jingyi-vaa.netlify.app/take-home_ex/take-home_ex01/take-home_ex01#data-visualization) for learning purposes only, based on my interpretation of [Prof Kam's Designing Graphics to Enlighten](https://isss608-ay2023-24apr.netlify.app/lesson/lesson02/lesson02-designing%20graphs%20to%20enlighten#/title-slide).

## Visualisation

In "Visualization 1 - How has transacted price varied over the 2024 Q1 and 2023", the following plot is presented:

![](images/clipboard-275283112.png)

### Aesthetics

+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Pros                                                                                                                                                            | Cons                                                                                                                                                                               |
+:================================================================================================================================================================+:===================================================================================================================================================================================+
| -   The presented charts are relatively well spaced, so while there is a lot of information, chart elements are not overlaid on top of each other and obscured. | -   At first glance, one could mistakenly assume that the 3 general colour groups i.e. blue, green, orange were meant to be a grouping, where:                                     |
|                                                                                                                                                                 |                                                                                                                                                                                    |
|                                                                                                                                                                 |     -   Group 1: Apartment, Condominium                                                                                                                                            |
|                                                                                                                                                                 |                                                                                                                                                                                    |
|                                                                                                                                                                 |     -   Group 2: Detached House, Semi-detached House, Terrace House                                                                                                                |
|                                                                                                                                                                 |                                                                                                                                                                                    |
|                                                                                                                                                                 |     -   Group 3: Executive Condominium                                                                                                                                             |
|                                                                                                                                                                 |                                                                                                                                                                                    |
|                                                                                                                                                                 | -   In addition, the light colours chosen, when presented with a light background in the raincloud plot, does not have good contrast.                                              |
|                                                                                                                                                                 |                                                                                                                                                                                    |
|                                                                                                                                                                 | -   It is unclear what the different shades of gray used for the line-bar chart represents                                                                                         |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| -   Colour theme of the plot is consistently applied, making reference between presented charts quick and easy                                                  | -   In-consistent Y axis for bar-line chart                                                                                                                                        |
|                                                                                                                                                                 |                                                                                                                                                                                    |
|                                                                                                                                                                 |     -   The right Y-axis label formats are not consistent. The top 3 charts have a typical number format, but the bottom 3 charts presents the numbers with a scientific notation. |
+-----------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

### Clarity

+-----------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Pros                                                                                                                                                | Cons                                                                                                                                                                                                   |
+=====================================================================================================================================================+========================================================================================================================================================================================================+
| -   Generally, the volumne of the bars in the stacked bar chart and line-bar chart correspond to their relative values, useful for quick comparison | -   It is not clear on first glance what the red dotted line separates:                                                                                                                                |
|                                                                                                                                                     |                                                                                                                                                                                                        |
|                                                                                                                                                     |     -   Timeline? In the bar-line chart and stacked bar chart, it appears to be separating timeline of interest, but it is unclear whether the right or left side is the timeline of interest.         |
|                                                                                                                                                     |                                                                                                                                                                                                        |
|                                                                                                                                                     |     -   Mean/Median? In the raincloud plot, there is no timeline per se, so it seems to denote the mean or median transacted price                                                                     |
+-----------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                                                                                                                     | -   In-consistent Y axis for bar-line chart                                                                                                                                                            |
|                                                                                                                                                     |                                                                                                                                                                                                        |
|                                                                                                                                                     |     -   Left Y-axis does not show the same scale across property types e.g. EC ranges from 0 to 500, and Apartment ranges from 0 to 1500. This makes direct comparison a little more tricky            |
|                                                                                                                                                     |                                                                                                                                                                                                        |
|                                                                                                                                                     |     -   Similarly, right Y-axis does not show the same scale across property types e.g. EC ranges from 0 to 1.5M, and Apartment ranges from 0 to 2M. This makes direct comparison a little more tricky |
+-----------------------------------------------------------------------------------------------------------------------------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

# Sketch for Alternative Design

# Getting Started

Jingyi's method for data wrangling will be used in order to keep the plots consistent.

## Installing and loading the required libraries

Note: Ensure that the [pacman](https://cran.r-project.org/web/packages/pacman/) package has already been installed.

The code chunk below loads the following packages using uses `p_load()` of pacman package:

+-----------------------+--------------------------------------------------------------------------------------+
| tidyverse             | -   Include dpylr for data manipulation with “mutate”, “group_by”, “summarize”, etc. |
|                       |                                                                                      |
|                       | -   Include ggplot2 for visualisation through histogram, boxplots, etc.              |
|                       |                                                                                      |
|                       | -   Include forcats for factoring and ordering of variables                          |
+-----------------------+--------------------------------------------------------------------------------------+
| ggdist                | -   For visualisation of distributions and uncertainity.                             |
|                       |                                                                                      |
| ggridges              | -   For creating density plots for visualisation of continuous distribution.         |
|                       |                                                                                      |
| ggrepel               | -   For repelling overlapping text labels in plot                                    |
|                       |                                                                                      |
| ggthemes & hrbrthemes | -   For customisation of plot appearance                                             |
+-----------------------+--------------------------------------------------------------------------------------+
| patchwork             | For combination and alignment of multiple plots for each visualisation.              |
+-----------------------+--------------------------------------------------------------------------------------+
| knitr                 | For elegant, flexible and fast report generation of underlying dataframes.           |
+-----------------------+--------------------------------------------------------------------------------------+

```{r}
pacman::p_load(ggrepel, patchwork, 
               ggthemes, hrbrthemes,
               tidyverse, readr, ggdist, ggridges, colorspace, knitr, forcats, reshape2, png, grid) 
```

## Importing the Data

-   The data has been split into multiple .csv files

-   They will be loaded seperately, then bound together using `rbind`.

```{r}
realis_1 <- read_csv("data/ResidentialTransaction20240308160536.csv")
realis_2 <- read_csv("data/ResidentialTransaction20240308160736.csv")
realis_3 <- read_csv("data/ResidentialTransaction20240308161009.csv")
realis_4 <- read_csv("data/ResidentialTransaction20240308161109.csv")
realis_5 <- read_csv("data/ResidentialTransaction20240414220633.csv")

realis_full <- rbind(realis_1, realis_2, realis_3, realis_4, realis_5)
```

## Summary of Data

`summary()` function used to obtain dataset min, max values and interquartile range.

::: panel-tabset
## Code

```{r, echo=FALSE}
# Understanding the distribution of numerical values in Realis 
realis_num <- realis_full[,c("Transacted Price ($)", "Area (SQFT)", "Unit Price ($ PSF)", "Number of Units")]

realis_num <- realis_num %>% 
  rename("Transacted_Price" = "Transacted Price ($)") %>% 
  rename("Area_SQFT" = "Area (SQFT)") %>%
  rename("Unit_Price_PSF" = "Unit Price ($ PSF)") %>% 
  rename("Number_of_Units" = "Number of Units")
  
kable(summary(realis_num))
```

## Overview of Tibble Data Frame

```{r,eval=FALSE}
# Understanding the distribution of numerical values in Realis 
realis_num <- realis_full[,c("Transacted Price ($)", "Area (SQFT)", "Unit Price ($ PSF)", "Number of Units")]

realis_num <- realis_num %>% 
  rename("Transacted_Price" = "Transacted Price ($)") %>% 
  rename("Area_SQFT" = "Area (SQFT)") %>%
  rename("Unit_Price_PSF" = "Unit Price ($ PSF)") %>% 
  rename("Number_of_Units" = "Number of Units")
  
kable(summary(realis_num))
```
:::

# Data Processing

### Manual Data Correction for Incorrect Data Entry

-   Re-labelling was performed for visibly wrong record. (e.g., `Completion Year` for [“The Hiller”](https://www.edgeprop.sg/condo-apartment/the-hillier) should be 2011 instead of 0216) and this was cross-checked with industry sources.

-   Referencing “Property Guru”, the property sold can be grouped into Central Core Region, Rest of Central Region and Outside of Central Region ([CCR, RCR and OCR](https://www.propertyguru.com.sg/property-guides/ccr-ocr-rcr-region-singapore-ura-map-21045)).

-   Hence, a new column of `Region_type` was created to reflect the 3 segmented zones based on classifying the existing values in `Postal District`.

```{r}
# Encoding postal district into CCR, RCR and OCR
realis_full <- realis_full %>% 
  mutate(`Postal District` = as.numeric(`Postal District`)) %>%
  mutate(Region_type = case_when(
    `Postal District` %in% c(01, 02, 04, 06, 07, 09,10, 11) ~ "CCR",
    `Postal District` %in% c(03, 05, 08, 12, 13, 14, 15, 20) ~ "RCR",
    `Postal District` %in% c(16, 17, 18, 19, 21, 22, 23, 24, 25, 26, 27, 28) ~ "OCR"
  ))
```

### Reclassification of `Postal District` to Reflect Proximity to City Center

-   a mapping of the `Postal District` values was mapped to easily recognised `Planning Area` that the public is familiar with.

```{r}
postal_mapping<- realis_full %>%
  group_by(`Planning Area`) %>%
  summarize(Distinct_Values = paste(unique(`Postal District`), collapse = ", "))

kable(postal_mapping, title = "Mapping of Planning Area to Postal District ")
```

### Standardisation

Large projects tend to spread across multiple postal codes, thus, a consistent postal code was assigned to each project. Revised postal code assigned is based on the highest frequency per project with the `group_by()` function.

```{r}
# Re-assigning large projects to a common postal code. (highest frequency postal code) for standardisation. 
realis_full <- realis_full %>%
  group_by(`Project Name`) %>%
  mutate(`Postal Code` = names(which.max(table(`Postal Code`)))) %>%
  ungroup()
```

### Converting `Tenure` into remaining lease life.

-   Converting `Tenure` into date format, excluding: “Freehold”, “99 or 999 years leasehold from uncompleted units”.

-   Calculating the remaining lease life based on `Sale Date`. (Rounded down to nearest no. of years)

-   Re-labeling back the records which are “Freehold” and “99 or 999 years leasehold” for uncompleted units.

```{r}
realis_clean <- realis_full %>%
  rowwise() %>%
  mutate(
    years = as.numeric(str_extract(Tenure, "\\d+(?=\\s+yrs)")),  # Extracts digits before " yrs" as years
    start_date = dmy(str_extract(Tenure, "\\d{2}/\\d{2}/\\d{4}")),  # Extracts date in "dd/mm/yyyy" format
    end_date = start_date + years(years),
    remaining_years = floor(as.numeric(difftime(end_date, Sys.Date(), units = "days") / 365)) # Calculate remaining years from days
  ) %>%
  ungroup()

realis_clean2 <- realis_clean %>%
  mutate(years_left = ifelse(!is.na(remaining_years), remaining_years, 
                             ifelse(Tenure == "999 years leasehold", "999", 
                                    ifelse(Tenure == "99 years leasehold", "99", 
                                           ifelse(Tenure == "Freehold", "Freehold", 
                                                  ifelse(Tenure == "110 yrs from 01/11/2017", "103",
                                                         ifelse(Tenure == "110 Yrs from 01/11/2017", "103", NA)))))))

# Converting character into date format
realis_clean2$`Sale Date` <- as.Date(realis_clean2$`Sale Date`, format = "%d %b %Y") 
```

## **Exploring outliers**

### Commercial En-bloc

The data set includes transactions that include commercial purchases that are infrequent and done by private developers for large land masses. This subset of transactions are unlikely to be done by individual buyers, and will be excluded from subsequent visualisation to prevent distortion of the axis.

-   `Number of Units` \> 5

-   `Type of Sale` = “Resale”

-   `Purchaser Address Indicator` =“Private”

-   `Tenure` = “Freehold”

```{r}
enbloc_set <- realis_full %>% filter(`Tenure` == "Freehold", 
                                     `Number of Units` > 5, 
                                     `Purchaser Address Indicator` == "Private", 
                                     `Type of Sale` == "Resale"
                                      )
enbloc_set_2 <- enbloc_set %>% 
  rename("Transacted_Price" = "Transacted Price ($)") %>% 
  rename("Area_SQFT" = "Area (SQFT)") %>%
  rename("Unit_Price_PSF" = "Unit Price ($ PSF)") %>% 
  rename("Sale_Date" = "Sale Date") %>% 
  rename("Number_of_Units" = "Number of Units")

kable(enbloc_set_2)
```

### Large new launches

Another subset identified are new project launches, where we observe a spike in transaction volumes in the month which new large developments are launched. While these transactions are not excluded from the visualisation dataset, this subset will be further analysed under section 3.3

-   `Type of Sale` = “New Sale”

-   `Completion Date` = “Uncompleted”

-   Sum of `Number of Units` group by `Project Name` \> 100

```{r}
Sale_by_proj <- realis_full %>% 
  group_by(`Project Name`) %>% 
  mutate(total_sale = sum(`Number of Units`))%>% 
  arrange(desc(total_sale)) %>%
  ungroup()
  
new_launch <- Sale_by_proj %>% 
  filter(`Type of Sale` == "New Sale", 
         `Completion Date` == "Uncompleted")

large_new_launch <- Sale_by_proj %>% 
  filter(`Type of Sale` == "New Sale", 
         `Completion Date` == "Uncompleted", 
         total_sale > 100)

large_new_launch <- large_new_launch %>% 
  rename("Unit_Price_PSF" = "Unit Price ($ PSF)")

new_proj_sale <- large_new_launch %>%
  group_by(`Project Name`) %>%
  summarize(proj_sale = total_sale, 
            median_proj_psf = median(as.numeric(`Unit_Price_PSF`))) %>%
  arrange(desc(proj_sale))

kable(head(distinct(new_proj_sale)), n =5)
```

### Luxury market

Transactions with `Transacted Price ($)` in the top 2.5% are excluded in earlier price distribution visualisations as they skewed the records.

```{r}
high_val <- realis_clean2 %>%
  filter(`Transacted Price ($)` > quantile(`Transacted Price ($)`, 0.975, na.rm = TRUE)) 

ind_high_val <- anti_join(high_val, enbloc_set, by = c("Tenure","Number of Units","Type of Sale"))
```

# **Visualization**

Diving into individual private residential purchases, the visualization data set used `Realis_vis` will exclude the subset of `Enbloc_set`.

```{r}
realis_vis <- anti_join(realis_clean2, enbloc_set, by = c("Tenure","Number of Units","Type of Sale"))
```

## Common Theme

Setting a common colour theme

```{r}
prop_col <- c("Apartment" = "#CCE5FF", 
              "Executive Condominium" = "#CCFF99", 
              "Condominium" = "#99CCff", 
              "Terrace House" = "#FFE5CC", 
              "Semi-Detached House" = "#FFCC99", 
              "Detached House" = "#FF9933")
```
